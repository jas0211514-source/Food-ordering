<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Spice & Sapore | Your Cart</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
    font-family:'Poppins',sans-serif;
    background: linear-gradient(135deg,#ffe5e0,#fff8f3);
    margin:0;
    padding-top:80px;
}
.navbar{
    background: rgba(255,255,255,0.85);
    backdrop-filter: blur(12px);
    box-shadow:0 5px 20px rgba(0,0,0,0.1);
}
.navbar-brand{
    color:#c1121f !important;
    font-weight:700;
}
.cart-container{
    max-width:900px;
    margin:auto;
}
.cart-card{
    background: rgba(255,255,255,0.7);
    backdrop-filter: blur(15px);
    border-radius:25px;
    padding:20px;
    margin-bottom:20px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    box-shadow:0 10px 25px rgba(0,0,0,0.08);
}
.cart-card img{
    width:80px;
    height:80px;
    object-fit:cover;
    border-radius:10px;
    margin-right:15px;
}
.cart-info{
    flex:1;
}
.quantity-box{
    display:flex;
    align-items:center;
}
.quantity-box button{
    background:#ff6b6b;
    border:none;
    color:white;
    width:35px;
    height:35px;
    border-radius:50%;
    font-weight:600;
    cursor:pointer;
}
.quantity-box span{
    margin:0 10px;
    font-weight:600;
}
.checkout-btn{
    background:#ff6b6b;
    color:white;
    padding:15px 40px;
    border:none;
    border-radius:30px;
    font-weight:600;
    display:block;
    margin:30px auto;
}
.modal-content{
    border-radius:25px;
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(15px);
    padding:30px;
    text-align:center;
}
.processing{
    font-weight:600;
    color:#ff6b6b;
    display:none;
}
</style>
</head>
<body>

<nav class="navbar fixed-top">
<div class="container">
<a class="navbar-brand" href="index.html">üçù Spice & Sapore</a>
</div>
</nav>

<div class="container cart-container mt-5">
<h2 class="text-center mb-4" style="color:#ff6b6b;font-weight:700;">Your Feast Awaits üçù</h2>
<div id="cart-items"></div>
<h4 class="text-center mt-4">Total: ‚Çπ<span id="total">0</span></h4>
<button class="checkout-btn" onclick="checkout()">Place Order</button>
</div>

<!-- Payment Modal -->
<div class="modal fade" id="paymentModal">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content">
<h4 class="mb-4">Choose Payment Method</h4>
<button class="btn btn-primary w-100 mb-3" onclick="selectPayment('Online Payment üí≥ (UPI)')">üí≥ Pay Online</button>
<button class="btn btn-success w-100" onclick="completeOrder('Cash on Delivery üíµ')">üíµ Cash on Delivery</button>
</div>
</div>
</div>

<!-- UPI Modal -->
<div class="modal fade" id="upiModal">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content">
<h4 class="mb-3">UPI Payment</h4>
<input type="text" id="upiInput" class="form-control mb-3" placeholder="example@upi">
<button class="btn btn-success w-100" onclick="fakePayment()">Pay Now</button>
<p class="processing mt-3" id="processingText">Processing Payment...</p>
</div>
</div>
</div>

<!-- OTP Modal -->
<div class="modal fade" id="otpModal">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content">
<h4 class="mb-3">üîê Enter OTP</h4>
<p class="text-muted">Demo OTP shown in alert</p>
<input type="text" id="otpInput" class="form-control mb-3" placeholder="Enter OTP">
<button class="btn btn-success w-100" onclick="verifyOTP()">Verify OTP</button>
<p id="otpError" class="text-danger mt-2"></p>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>

let cart = JSON.parse(localStorage.getItem("cart")) || [];
let generatedOTP = "";
let pendingPaymentMethod = "";

function displayCart(){
    const container=document.getElementById("cart-items");
    container.innerHTML="";
    let total=0;

    if(cart.length===0){
        container.innerHTML="<p class='text-center'>Your cart is empty üòÖ</p>";
    }

    cart.forEach((item,index)=>{
        if(!item.quantity) item.quantity=1;
        total+=item.price*item.quantity;

        container.innerHTML+=`
        <div class="cart-card">
            <img src="${item.image || 'https://via.placeholder.com/80'}">
            <div class="cart-info">
                <h5>${item.name}</h5>
                <p>‚Çπ${item.price}</p>
            </div>
            <div class="quantity-box">
                <button onclick="changeQty(${index},-1)">-</button>
                <span>${item.quantity}</span>
                <button onclick="changeQty(${index},1)">+</button>
            </div>
        </div>`;
    });

    document.getElementById("total").innerText=total;
}

function changeQty(index,val){
    cart[index].quantity+=val;
    if(cart[index].quantity < 1){
        cart.splice(index,1);
    }
    localStorage.setItem("cart",JSON.stringify(cart));
    displayCart();
}

function checkout(){
    if(cart.length===0){
        alert("Your cart is empty üòÖ");
        return;
    }
    new bootstrap.Modal(document.getElementById("paymentModal")).show();
}

function selectPayment(method){
    const payModal=bootstrap.Modal.getInstance(document.getElementById("paymentModal"));
    payModal.hide();

    pendingPaymentMethod = method;
    new bootstrap.Modal(document.getElementById("upiModal")).show();
}

function fakePayment(){
    const upi=document.getElementById("upiInput").value;
    if(upi.trim()===""){
        alert("Enter UPI ID üòÖ");
        return;
    }

    document.getElementById("processingText").style.display="block";

    setTimeout(()=>{
        const upiModal=bootstrap.Modal.getInstance(document.getElementById("upiModal"));
        upiModal.hide();
        completeOrder(pendingPaymentMethod);
    },2500);
}

function completeOrder(method){

    pendingPaymentMethod = method;

    generatedOTP = Math.floor(1000 + Math.random() * 9000).toString();

    alert("Demo OTP: " + generatedOTP);

    new bootstrap.Modal(document.getElementById("otpModal")).show();
}

function verifyOTP(){

    const userOTP = document.getElementById("otpInput").value;

    if(userOTP === generatedOTP){

        const orderID = "SS" + Math.floor(100000 + Math.random() * 900000);

        let orderDetails = "";
        cart.forEach(item => {
            orderDetails += item.name + " x " + item.quantity + "<br>";
        });

        // Get existing orders
        let allOrders = JSON.parse(localStorage.getItem("allOrders")) || [];

        // Create new order object
        const newOrder = {
            id: orderID,
            items: orderDetails,
            payment: pendingPaymentMethod,
            otp: generatedOTP,
            status: "üßë‚Äçüç≥ Order Received",
            deliveryTime: ""
        };

        // Add to array
        allOrders.push(newOrder);

        // Save back
        localStorage.setItem("allOrders", JSON.stringify(allOrders));

        localStorage.removeItem("cart");

        const otpModal = bootstrap.Modal.getInstance(document.getElementById("otpModal"));
        otpModal.hide();

        setTimeout(()=>{
            window.location.href="tracking.html";
        },800);

    } else {
        document.getElementById("otpError").innerText="‚ùå Incorrect OTP!";
    }
}
displayCart();

</script>

</body>
</html>